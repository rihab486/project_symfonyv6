{% extends 'base.html.twig' %}

{% block title %}JStore | Your account{% endblock %}

{% block body %}
{% include "page_head/page_head.html.twig" with {'page_name':'Account'}%}
<!-- START MAIN CONTENT -->
<div class="main_content">

<!-- START SECTION SHOP -->
<div class="section">
	<div class="container">
        <div class="row">
            <div class="col-lg-3 col-md-4">
                <div class="dashboard_menu">
                    <ul class="nav nav-tabs flex-column" role="tablist">
                      <li class="nav-item">
                        <a class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" href="#dashboard" role="tab" aria-controls="dashboard" aria-selected="false"><i class="ti-layout-grid2"></i>Dashboard</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" id="orders-tab" data-bs-toggle="tab" href="#orders" role="tab" aria-controls="orders" aria-selected="false"><i class="ti-shopping-cart-full"></i>Orders</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" id="address-tab" data-bs-toggle="tab" href="#address" role="tab" aria-controls="address" aria-selected="true"><i class="ti-location-pin"></i>My Address</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" id="account-detail-tab" data-bs-toggle="tab" href="#account-detail" role="tab" aria-controls="account-detail" aria-selected="true"><i class="ti-id-badge"></i>Account details</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" id="logout-tab"  href="#logout" data-bs-toggle="tab" role="tab" aria-controls="logout" aria-selected="true" ><i class="ti-lock"></i>Logout</a>
                      </li>
                    </ul>
                </div>
            </div>
            <div class="col-lg-9 col-md-8">
                <div class="tab-content dashboard_content">
                  	<div class="tab-pane fade active show" id="dashboard" role="tabpanel" aria-labelledby="dashboard-tab">
                    	<div class="card">
                        	<div class="card-header">
                                <h3>Dashboard</h3>
                            </div>
                            <div class="card-body">
                    			<p>From your account dashboard. you can easily check &amp; view your <a href="javascript:void(0);" onclick="$('#orders-tab').trigger('click')">recent orders</a>, manage your <a href="javascript:void(0);" onclick="$('#address-tab').trigger('click')">shipping and billing addresses</a> and <a href="javascript:void(0);" onclick="$('#account-detail-tab').trigger('click')">edit your password and account details.</a></p>
                            </div>
                        </div>
                  	</div>
                  	<div class="tab-pane fade" id="logout" role="tabpanel" aria-labelledby="logout-tab">
                    	<div class="card">
                        	<div class="card-header">
                                <h3>Logout</h3>
                            </div>
                            <div class="card-body">
                    			<p>From your account dashboard. you can easily check &amp; view your <a href="javascript:void(0);" onclick="$('#orders-tab').trigger('click')">recent orders</a>, manage your <a href="javascript:void(0);" onclick="$('#address-tab').trigger('click')">shipping and billing addresses</a> and <a href="javascript:void(0);" onclick="$('#account-detail-tab').trigger('click')">edit your password and account details.</a></p>
                                <button type="submit" class="btn btn-fill-out py-2" name="submit" value="Submit">Logout</button>
                            </div>
                        </div>
                  	</div>
                  	<div class="tab-pane fade" id="orders" role="tabpanel" aria-labelledby="orders-tab">
                    	<div class="card">
                        	<div class="card-header">
                                <h3>Orders</h3>
                            </div>
                            <div class="card-body">
                    			<div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Order</th>
                                                <th>Date</th>
                                                <th>Status</th>
                                                <th>Total</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>#1234</td>
                                                <td>March 15, 2020</td>
                                                <td>Processing</td>
                                                <td>$78.00 for 1 item</td>
                                                <td><a href="#" class="btn btn-fill-out btn-sm">View</a></td>
                                            </tr>
                                            <tr>
                                                <td>#2366</td>
                                                <td>June 20, 2020</td>
                                                <td>Completed</td>
                                                <td>$81.00 for 1 item</td>
                                                <td><a href="#" class="btn btn-fill-out btn-sm">View</a></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                  	</div>
					<div class="tab-pane fade " id="address" role="tabpanel" aria-labelledby="address-tab">
                           <div class="row">
                                <div class="action d-flex mb-2">
                                    <a href="#" id="add_new_address" class="btn btn-fill-out">Add New</a>

                                </div>
                                <div class="col-lg-12 d-none" id="add_form">
                                    <form action="post">
                                        <div class="row">
                                            <div class="form-group col-md-12 mb-3">
                                                <label>Address Type <span class="required">*</span></label>
                                                <select name="address_type" id="" class="form-control" style="">
                                                    <option value="Billing">Billing</option>
                                                    <option value="Shipping">Shipping</option>
                                                </select>
                                            </div>
                                            <div class="form-group col-md-12 mb-3">
                                                <label>Name <span class="required">*</span></label>
                                                <input required="" class="form-control" name="name" type="text">
                                            </div>
                                            <div class="form-group col-md-12 mb-3">
                                                <label>Full Name <span class="required">*</span></label>
                                                <input required="" class="form-control" name="client_name" type="text">
                                            </div>
                                            <div class="form-group col-md-6 mb-3">
                                                <label>Street <span class="required">*</span></label>
                                                <input required="" class="form-control" name="street" type="text">
                                            </div>
                                            <div class="form-group col-md-6 mb-3">
                                                <label>Code Zip <span class="required">*</span></label>
                                                <input required="" class="form-control" name="code_postal" type="text">
                                            </div>
                                            <div class="form-group col-md-6 mb-3">
                                                <label>City <span class="required">*</span></label>
                                                <input required="" class="form-control" name="city" type="text">
                                            </div>
                                            <div class="form-group col-md-6 mb-3">
                                                <label>Country <span class="required">*</span></label>
                                                <input required="" class="form-control" name="state" type="text">
                                            </div>
                                            <div class="d-flex">
                                                <button class="btn btn-fill-out">Save</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="col-lg-12 d-block" id="address_details">
                                <div class="card">
                                        <div class="card-header">
                                            <h3>Addresses</h3>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive address_content">
                                                <table class="table">
                                                    <thead>
                                                        <tr>
                                                            <th>Id</th>
                                                            <th>Addresse</th>
                                                            <th>Action</th>
                                                         
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                       {% for address in addresses %}
                                                          <tr>
                                                            <td>{{address.id}}</td>
                                                           
                                                            <td> {{address.street}} {{address.codePostal}} {{address.city}} {{address.state}}</td>
                                                            <td><a  href="" class="btn btn-fill-out btn-sm edit-address">Edit</a></td>
                                                             <td><a  href="" class="btn btn-fill-out btn-sm remove_address">Delete</a></td>
                                                        
                                                        </tr>
                                                        {% endfor %}
                                                       
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    {% for address in addresses %}
                                    
                                    
                                     <div class="col-lg-5">
                                            <div class="card mb-3 mb-lg-0">
                                                <div class="card-header">
                                                    <h3>{{ address.addressType}} Address</h3>
                                                </div>
                                                <div class="card-body">
                                                    <address>{{ address.street}}<br>
                                                        {{ address.codePostal}}<br>
                                                        {{ address.city}} <br>
                                                        {{ address.state}} <br> 
                                                    </address>
                                                    <p>{{ address.moreDetails}}</p>
                                                    <a href="#" class="btn btn-fill-out">Edit</a>
                                                </div>
                                            </div>
                                        </div>
                                   
                                       
                                    {% endfor %}
                                    
                                </div>

                            </div>
                    
					</div>
                    <div class="tab-pane fade" id="account-detail" role="tabpanel" aria-labelledby="account-detail-tab">
						<div class="card">
                          
                       
                        	<div class="card-header">
                                <h3>Account Details</h3>
                            </div>
                            <div class="card-body">
                    			<p>Already have an account? <a href="#">Log in instead!</a></p>
                                <form method="post" name="enq">
                                    <div class="row">
                                        <div class="form-group col-md-6 mb-3">
                                        	<label>First Name <span class="required">*</span></label>
                                            <input required="" class="form-control" name="name" type="text">
                                         </div>
                                         <div class="form-group col-md-6 mb-3">
                                        	<label>Last Name <span class="required">*</span></label>
                                            <input required="" class="form-control" name="phone">
                                        </div>
                                        <div class="form-group col-md-12 mb-3">
                                        	<label>Display Name <span class="required">*</span></label>
                                            <input required="" class="form-control" name="dname" type="text">
                                        </div>
                                        <div class="form-group col-md-12 mb-3">
                                        	<label>Email Address <span class="required">*</span></label>
                                            <input required="" class="form-control" name="email" type="email">
                                        </div>
                                        <div class="form-group col-md-12 mb-3">
                                        	<label>Current Password <span class="required">*</span></label>
                                            <input required="" class="form-control" name="password" type="password">
                                        </div>
                                        <div class="form-group col-md-12 mb-3">
                                        	<label>New Password <span class="required">*</span></label>
                                            <input required="" class="form-control" name="npassword" type="password">
                                        </div>
                                        <div class="form-group col-md-12 mb-3">
                                        	<label>Confirm Password <span class="required">*</span></label>
                                            <input required="" class="form-control" name="cpassword" type="password">
                                        </div>
                                        <div class="col-md-12">
                                            <button type="submit" class="btn btn-fill-out" name="submit" value="Submit">Save</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- END SECTION SHOP -->



</div>


       const displayAddress = (addresses) => {
        const tbody = document.querySelector(".address_content tbody")
        if (tbody) {
            tbody.innerHTML = ""
            addresses.forEach(address => {
                tbody.innerHTML += `
               
              
                `

            });
            addform.classList.add("d-none")
            addressDetails.classList.remove("d-none")
            addAddressButton.innerHTML = "Add New"
            addEvent()
        }
    }
{% endblock %}

{% block javascripts %}

<script>
    const addform = document.getElementById("add_form")
    const addAddressButton = document.getElementById("add_new_address");
    const addressDetails = document.getElementById("address_details")

    const displayAddress = (addresses) => {
        const tbody = document.querySelector(".address_content tbody")
        if (tbody) {
            tbody.innerHTML = ""
            addresses.forEach(address => {
                tbody.innerHTML += `
                <tr>
                    <td>#${address.id}</td>
                    <td>${address.street} ${address.codePostal} ${address.city} ${address.state}</td>                       
                    <td><a href="#" class="btn btn-fill-out btn-sm edit_address">Edit</a></td>
                    <td><a href="#" data-id="${address.id}" class="btn btn-fill-out btn-sm remove_address">Delete</a></td>
                </tr>
                `

            });
            addform.classList.add("d-none")
            addressDetails.classList.remove("d-none")
            addAddressButton.innerHTML = "Add New"
            addEvent()
        }
    }



    const addEvent = (address) => {
        const addform = document.getElementById("add_form")
        const addAddressButton = document.getElementById("add_new_address");
        const addressDetails = document.getElementById("address_details")
        const remove_address_btns = document.querySelectorAll(".remove_address")


        remove_address_btns.forEach((remove_address_btn) => {
            remove_address_btn.addEventListener("click", async (event) => {
                event.preventDefault()
                const element = event.target
                const id = element.dataset.id
    
                if (id) {
                    const response = await fetch("/api/address/" + id, {
                        method: "DELETE"
                    })
    
                    const result = await response.json()
    
                    console.log(result);
    
                    if (result.isSuccess) {
                        const addresses = result.data
                        displayAddress(addresses)
                    }
                }
            })
        });

        addform.addEventListener("submit", async (event) => {
            event.preventDefault()
            console.log("------- SUBMIT ------------");
            const form = document.querySelector("#add_form form")
            const formData = new FormData(form)

            const response = await fetch("/api/address", {
                method: "POST",
                body: formData
            })

            const result = await response.json()

            if (result.isSuccess) {
                const addresses = result.data

                displayAddress(addresses)

            }


        })

    }

    addAddressButton.addEventListener("click", (event) => {
        event.preventDefault()
        if (addform.classList.contains("d-none")) {
            addform.classList.remove("d-none")
            addressDetails.classList.add("d-none")
            addAddressButton.innerHTML = "Cancel"
        } else {
            addAddressButton.innerHTML = "Add New"
            addform.classList.add("d-none")
            addressDetails.classList.remove("d-none")

        }
    })




    addEvent()


</script>
{% endblock %}


          
